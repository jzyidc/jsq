import{_ as Y}from"./_plugin-vue_export-helper-e4601500.js";/* empty css                  *//* empty css                *//* empty css               *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css               *//* empty css                     */import{r as y,$ as U,a9 as ee,o as ae,c as v,d as D,i as e,w as l,bo as te,E as _,aG as le,g as o,j as C,bp as $,l as w,F as T,h as A,k as I,Q as se,aN as oe,D as m,aP as ne,ar as M,bq as L,p as re,q as de,aR as ie,aS as ue,a3 as pe,a2 as ce,a1 as _e,aH as me,az as ge,aU as fe,t as ve,aV as be,aW as he,aZ as xe}from"./index-cf8bdcfb.js";const ye={class:"expired-business"},we={class:"card-header"},Ee={class:"header-actions"},De={class:"search-area"},Ce={class:"stats-area"},Ie={class:"stat-card expired"},Ve={class:"stat-number"},ze={class:"stat-card expiring"},Se={class:"stat-number"},Te={class:"stat-card total"},Ae={class:"stat-number"},Ne={class:"stat-card selected"},ke={class:"stat-number"},Ge={class:"table-area"},Be={class:"proxy-info"},Pe={class:"proxy-port"},Ue={class:"pagination-area"},$e={__name:"Expired",setup(Me){const V=y(!1),b=y([]),g=y([]),N=y([]),k=y([]),G=y([]),n=U({game:"",area:"",group:"",screenNode:"",expiredDays:""}),i=U({page:1,size:20,total:0}),z=ee(()=>{const s=b.value.filter(p=>p.ExpiredDays>0).length,a=b.value.filter(p=>p.ExpiredDays<=3&&p.ExpiredDays>=0).length;return{expired:s,expiring:a,total:b.value.length,selected:g.value.length}}),q=s=>s<=0?"success":s<=3?"warning":s<=7?"danger":"info",F=s=>{g.value=s},R=()=>{i.page=1,h()},j=()=>{Object.assign(n,{game:"",area:"",group:"",screenNode:"",expiredDays:""}),i.page=1,h()},O=s=>{i.size=s,h()},H=s=>{i.page=s,h()},Q=s=>{M.confirm(`确定要删除游戏 ${s.Game} 地区 ${s.Area} 的过期业务吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const a=await L({Id:[s.Id.toString()]});a.Code===1e3?(_.success("删除成功"),h()):_.error(a.Msg||"删除失败")}catch(a){console.error("删除节点失败:",a),_.error("删除失败")}})},W=()=>{if(g.value.length===0){_.warning("请选择要删除的业务");return}M.confirm(`确定要删除选中的 ${g.value.length} 个过期业务吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const s=g.value.map(p=>p.Id.toString()),a=await L({Id:s});a.Code===1e3?(_.success("批量删除成功"),g.value=[],h()):_.error(a.Msg||"批量删除失败")}catch(s){console.error("批量删除节点失败:",s),_.error("批量删除失败")}})},h=async()=>{V.value=!0;try{const s={page:i.page,pageSize:i.size};n.game&&(s.game=n.game),n.area&&(s.area=n.area),n.group&&(s.group=n.group),n.screenNode&&(s.ScreenNode=n.screenNode),n.expiredDays&&(s.expiredDays=n.expiredDays);const a=await te(s);if(a.Code===1e3){const c=(a.List||[]).map(r=>{const S=new Date(r.EndTime)-new Date,d=Math.ceil(S/(1e3*60*60*24));return{...r,ExpiredDays:d>0?0:Math.abs(d),User:`user${r.Id}`,Pass:`pass${r.Id}`,Connect_IpAddress:r.IpAddress,Port:"8080"}});b.value=c,i.total=a.RowCount||0;const u=[...new Set(c.map(r=>r.Game))],x=[...new Set(c.map(r=>r.Area))],f=[...new Set(c.map(r=>r.Group).filter(r=>r))];N.value=u.map(r=>({Game:r})),k.value=x.map(r=>({Area:r})),G.value=f}else _.error(a.Msg||"获取数据失败"),b.value=[],i.total=0}catch(s){console.error("获取过期业务数据失败:",s),_.error("获取数据失败"),b.value=[],i.total=0}finally{V.value=!1}};return ae(()=>{h()}),(s,a)=>{const p=re,c=de,u=ie,x=ue,f=pe,r=ce,B=_e,E=me,S=ge,d=fe,P=ve,Z=be,J=he,K=le,X=xe;return v(),D("div",ye,[e(K,{class:"page-card"},{header:l(()=>[o("div",we,[a[8]||(a[8]=o("span",null,"过期业务",-1)),o("div",Ee,[e(c,{type:"danger",onClick:W,disabled:g.value.length===0},{default:l(()=>[e(p,null,{default:l(()=>[e(C($))]),_:1}),a[7]||(a[7]=w(" 批量删除 "))]),_:1,__:[7]},8,["disabled"])])])]),default:l(()=>[o("div",De,[e(B,{model:n,inline:""},{default:l(()=>[e(f,{label:"游戏"},{default:l(()=>[e(x,{modelValue:n.game,"onUpdate:modelValue":a[0]||(a[0]=t=>n.game=t),placeholder:"请选择游戏",clearable:"",style:{width:"200px"}},{default:l(()=>[e(u,{label:"全部",value:""}),(v(!0),D(T,null,A(N.value,t=>(v(),I(u,{key:t.Game,label:t.Game,value:t.Game},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"区域"},{default:l(()=>[e(x,{modelValue:n.area,"onUpdate:modelValue":a[1]||(a[1]=t=>n.area=t),placeholder:"请选择区域",clearable:"",style:{width:"200px"}},{default:l(()=>[e(u,{label:"全部",value:""}),(v(!0),D(T,null,A(k.value,t=>(v(),I(u,{key:t.Area,label:t.Area,value:t.Area},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"分组"},{default:l(()=>[e(x,{modelValue:n.group,"onUpdate:modelValue":a[2]||(a[2]=t=>n.group=t),placeholder:"请选择分组",clearable:"",style:{width:"120px"}},{default:l(()=>[e(u,{label:"全部",value:""}),(v(!0),D(T,null,A(G.value,t=>(v(),I(u,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"IP/链接"},{default:l(()=>[e(r,{modelValue:n.screenNode,"onUpdate:modelValue":a[3]||(a[3]=t=>n.screenNode=t),placeholder:"请输入IP或链接地址",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(f,{label:"过期时间"},{default:l(()=>[e(x,{modelValue:n.expiredDays,"onUpdate:modelValue":a[4]||(a[4]=t=>n.expiredDays=t),placeholder:"过期天数",clearable:"",style:{width:"120px"}},{default:l(()=>[e(u,{label:"1天内",value:"1"}),e(u,{label:"3天内",value:"3"}),e(u,{label:"7天内",value:"7"}),e(u,{label:"30天内",value:"30"}),e(u,{label:"全部",value:""})]),_:1},8,["modelValue"])]),_:1}),e(f,null,{default:l(()=>[e(c,{type:"primary",onClick:R},{default:l(()=>[e(p,null,{default:l(()=>[e(C(se))]),_:1}),a[9]||(a[9]=w(" 搜索 "))]),_:1,__:[9]}),e(c,{onClick:j},{default:l(()=>[e(p,null,{default:l(()=>[e(C(oe))]),_:1}),a[10]||(a[10]=w(" 重置 "))]),_:1,__:[10]})]),_:1})]),_:1},8,["model"])]),o("div",Ce,[e(S,{gutter:16},{default:l(()=>[e(E,{span:6},{default:l(()=>[o("div",Ie,[o("div",Ve,m(z.value.expired),1),a[11]||(a[11]=o("div",{class:"stat-label"},"已过期",-1))])]),_:1}),e(E,{span:6},{default:l(()=>[o("div",ze,[o("div",Se,m(z.value.expiring),1),a[12]||(a[12]=o("div",{class:"stat-label"},"即将释放",-1))])]),_:1}),e(E,{span:6},{default:l(()=>[o("div",Te,[o("div",Ae,m(z.value.total),1),a[13]||(a[13]=o("div",{class:"stat-label"},"总计",-1))])]),_:1}),e(E,{span:6},{default:l(()=>[o("div",Ne,[o("div",ke,m(g.value.length),1),a[14]||(a[14]=o("div",{class:"stat-label"},"已选择",-1))])]),_:1})]),_:1})]),o("div",Ge,[ne((v(),I(Z,{data:b.value,onSelectionChange:F,stripe:"",style:{width:"100%"}},{default:l(()=>[e(d,{type:"selection",width:"55"}),e(d,{prop:"Game",label:"游戏",width:"120"}),e(d,{prop:"Area",label:"地区",width:"100"}),e(d,{prop:"Group",label:"分组",width:"80"}),e(d,{prop:"Isp",label:"线路",width:"60"}),e(d,{prop:"IpAddress",label:"节点IP",width:"125"}),e(d,{label:"代理信息",width:"200"},{default:l(({row:t})=>[o("div",Be,[o("div",null,"用户: "+m(t.User||`user${t.Id}`),1),o("div",null,"密码: "+m(t.Pass||`pass${t.Id}`),1),o("div",null,"链接: "+m(t.Connect_IpAddress||t.IpAddress),1),o("div",Pe,"端口: "+m(t.Port||"8080"),1)])]),_:1}),e(d,{prop:"StartTime",label:"开始时间",width:"120"}),e(d,{prop:"EndTime",label:"到期时间",width:"120"}),e(d,{label:"过期天数",width:"100"},{default:l(({row:t})=>[e(P,{type:q(t.ExpiredDays),size:"small"},{default:l(()=>[w(m(t.ExpiredDays)+"天 ",1)]),_:2},1032,["type"])]),_:1}),e(d,{label:"状态",width:"80"},{default:l(({row:t})=>[e(P,{type:"danger",size:"small"},{default:l(()=>a[15]||(a[15]=[w("已过期")])),_:1,__:[15]})]),_:1}),e(d,{label:"操作",width:"100",fixed:"right"},{default:l(({row:t})=>[e(c,{size:"small",type:"danger",onClick:Le=>Q(t)},{default:l(()=>[e(p,null,{default:l(()=>[e(C($))]),_:1}),a[16]||(a[16]=w(" 删除 "))]),_:2,__:[16]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,V.value]]),o("div",Ue,[e(J,{"current-page":i.page,"onUpdate:currentPage":a[5]||(a[5]=t=>i.page=t),"page-size":i.size,"onUpdate:pageSize":a[6]||(a[6]=t=>i.size=t),"page-sizes":[10,20,50,100],total:i.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:O,onCurrentChange:H},null,8,["current-page","page-size","total"])])])]),_:1})])}}},Ye=Y($e,[["__scopeId","data-v-5ab18ee8"]]);export{Ye as default};
