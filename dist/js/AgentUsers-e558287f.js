import{_ as oe}from"./_plugin-vue_export-helper-e4601500.js";/* empty css                  *//* empty css                 *//* empty css                        *//* empty css                   *//* empty css                             *//* empty css               *//* empty css                     *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css               *//* empty css                *//* empty css                     *//* empty css                       */import{r as c,$ as L,a9 as ne,o as re,c as z,d as F,i as e,w as a,E as w,aG as de,aA as ie,g as o,j as y,Q as ue,l as n,aN as ce,z as _e,D as r,aB as pe,aF as me,C as fe,aP as ve,k as ge,f as $,a2 as he,a3 as be,aT as we,p as ye,q as De,a1 as Ue,aH as Ve,az as Ce,aU as Ee,t as xe,aV as Pe,aW as Re,aX as ke,aY as ze,bb as Me,aZ as Se}from"./index-cf8bdcfb.js";import{h as Ye,i as Fe}from"./finance-f416d1f2.js";const Ie={class:"agent-users-container"},Ne={class:"users-content"},Te={class:"stat-item"},Be={class:"stat-icon"},Le={class:"stat-content"},$e={class:"stat-value"},He={class:"stat-item"},Ae={class:"stat-icon"},je={class:"stat-content"},qe={class:"stat-value"},Ge={class:"stat-item"},Qe={class:"stat-icon"},We={class:"stat-content"},Xe={class:"stat-value"},Ze={class:"stat-item"},Je={class:"stat-icon"},Ke={class:"stat-content"},Oe={class:"stat-value"},et={class:"table-container"},tt={class:"amount"},at={class:"balance"},lt={key:0,class:"pagination-wrapper"},st={key:0,class:"user-detail"},ot={__name:"AgentUsers",setup(nt){const E=c(!1),D=c([]),x=c(0),v=c(1),P=c(20),R=c(!1),u=c(null),U=c(!1),M=c(!1),S=c(null),_=L({phone:"",discount:.5}),H={discount:[{required:!0,message:"请输入折扣值",trigger:"blur"},{type:"number",min:.1,max:1,message:"折扣值必须在0.1-1.0之间",trigger:"blur"}]},d=L({screenPhone:"",screenReferrerPhone:"",dateRange:[]}),f=c({totalUsers:0,todayUsers:0,monthUsers:0,activeUsers:0}),A=ne(()=>{const l={page:v.value,pageSize:P.value,screenPhone:d.screenPhone,screenReferrerPhone:d.screenReferrerPhone};return d.dateRange&&d.dateRange.length===2&&(l.screenStartTime=d.dateRange[0],l.screenEndTime=d.dateRange[1]),l}),h=async()=>{try{E.value=!0;const l=await Ye(A.value);l.Code===1e3?(D.value=l.List||[],x.value=l.RowCount||0,j()):w.error(l.Msg||"获取用户列表失败")}catch(l){console.error("获取用户列表失败:",l),w.error("获取用户列表失败")}finally{E.value=!1}},j=()=>{const l=new Date().toDateString(),t=new Date().getMonth(),V=new Date().getFullYear();f.value.totalUsers=x.value,f.value.todayUsers=D.value.filter(i=>new Date(i.reg_time).toDateString()===l).length,f.value.monthUsers=D.value.filter(i=>{const C=new Date(i.reg_time);return C.getMonth()===t&&C.getFullYear()===V}).length,f.value.activeUsers=D.value.filter(i=>parseFloat(i.balance)>0).length},q=()=>{v.value=1,h()},G=()=>{d.screenPhone="",d.screenReferrerPhone="",d.dateRange=[],v.value=1,h()},Q=l=>{P.value=l,v.value=1,h()},W=l=>{v.value=l,h()},X=l=>{u.value=l,R.value=!0},I=l=>l?new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-",Z=l=>{_.phone=l.phone,_.discount=parseFloat(l.discount)||.5,U.value=!0},J=async()=>{if(S.value)try{await S.value.validate();const l=.8;if(_.discount<l){w.warning(`折扣值不能低于代理折扣值 ${l}`);return}M.value=!0;const t=await Fe(_.phone,_.discount.toString());t.Code===1e3?(w.success(t.Msg||"设置成功"),U.value=!1,h()):w.error(t.Msg||"设置失败")}catch(l){console.error("设置折扣失败:",l),w.error("设置折扣失败")}finally{M.value=!1}};return re(()=>{h()}),(l,t)=>{const V=he,i=be,C=we,b=ye,g=De,N=Ue,Y=de,k=Ve,K=Ce,p=Ee,T=xe,O=Pe,ee=Re,m=ke,te=ze,B=ie,ae=Me,le=Se;return z(),F("div",Ie,[e(Y,{class:"users-card"},{header:a(()=>t[11]||(t[11]=[o("div",{class:"card-header"},[o("h3",null,"代理用户"),o("p",null,"管理您推广的用户信息")],-1)])),default:a(()=>[o("div",Ne,[e(Y,{class:"filter-card",shadow:"never"},{default:a(()=>[e(N,{model:d,inline:!0,class:"filter-form"},{default:a(()=>[e(i,{label:"用户手机号"},{default:a(()=>[e(V,{modelValue:d.screenPhone,"onUpdate:modelValue":t[0]||(t[0]=s=>d.screenPhone=s),placeholder:"请输入用户手机号",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(i,{label:"推荐人手机号"},{default:a(()=>[e(V,{modelValue:d.screenReferrerPhone,"onUpdate:modelValue":t[1]||(t[1]=s=>d.screenReferrerPhone=s),placeholder:"请输入推荐人手机号",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(i,{label:"注册时间"},{default:a(()=>[e(C,{modelValue:d.dateRange,"onUpdate:modelValue":t[2]||(t[2]=s=>d.dateRange=s),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"350px"}},null,8,["modelValue"])]),_:1}),e(i,null,{default:a(()=>[e(g,{type:"primary",onClick:q,loading:E.value},{default:a(()=>[e(b,null,{default:a(()=>[e(y(ue))]),_:1}),t[12]||(t[12]=n(" 搜索 "))]),_:1,__:[12]},8,["loading"]),e(g,{onClick:G},{default:a(()=>[e(b,null,{default:a(()=>[e(y(ce))]),_:1}),t[13]||(t[13]=n(" 重置 "))]),_:1,__:[13]})]),_:1})]),_:1},8,["model"])]),_:1}),e(K,{gutter:20,class:"stats-row"},{default:a(()=>[e(k,{xs:24,sm:12,md:6},{default:a(()=>[o("div",Te,[o("div",Be,[e(b,null,{default:a(()=>[e(y(_e))]),_:1})]),o("div",Le,[o("div",$e,r(f.value.totalUsers),1),t[14]||(t[14]=o("div",{class:"stat-label"},"总用户数",-1))])])]),_:1}),e(k,{xs:24,sm:12,md:6},{default:a(()=>[o("div",He,[o("div",Ae,[e(b,null,{default:a(()=>[e(y(pe))]),_:1})]),o("div",je,[o("div",qe,r(f.value.todayUsers),1),t[15]||(t[15]=o("div",{class:"stat-label"},"今日新增",-1))])])]),_:1}),e(k,{xs:24,sm:12,md:6},{default:a(()=>[o("div",Ge,[o("div",Qe,[e(b,null,{default:a(()=>[e(y(me))]),_:1})]),o("div",We,[o("div",Xe,r(f.value.monthUsers),1),t[16]||(t[16]=o("div",{class:"stat-label"},"本月新增",-1))])])]),_:1}),e(k,{xs:24,sm:12,md:6},{default:a(()=>[o("div",Ze,[o("div",Je,[e(b,null,{default:a(()=>[e(y(fe))]),_:1})]),o("div",Ke,[o("div",Oe,r(f.value.activeUsers),1),t[17]||(t[17]=o("div",{class:"stat-label"},"活跃用户",-1))])])]),_:1})]),_:1}),e(Y,{class:"table-card",shadow:"never"},{header:a(()=>t[18]||(t[18]=[o("h4",null,"用户列表",-1)])),default:a(()=>[o("div",et,[ve((z(),ge(O,{data:D.value,style:{width:"100%"}},{default:a(()=>[e(p,{prop:"phone",label:"手机号",width:"130"}),e(p,{prop:"referrer_phone",label:"推荐人手机号",width:"130"}),e(p,{prop:"reg_time",label:"注册时间",width:"180"},{default:a(s=>[n(r(I(s.row.reg_time)),1)]),_:1}),e(p,{prop:"total_payment",label:"累计充值",width:"120"},{default:a(s=>[o("span",tt,"¥"+r(s.row.total_payment||"0.00"),1)]),_:1}),e(p,{prop:"balance",label:"账户余额",width:"120"},{default:a(s=>[o("span",at,"¥"+r(s.row.balance||"0.00"),1)]),_:1}),e(p,{prop:"discount",label:"折扣",width:"100"},{default:a(s=>[e(T,{type:"success",size:"small"},{default:a(()=>[n(r(s.row.discount),1)]),_:2},1024)]),_:1}),e(p,{prop:"node_count",label:"节点数",width:"100"}),e(p,{prop:"reg_ip",label:"注册IP",width:"140"}),e(p,{label:"操作",width:"200",fixed:"right"},{default:a(s=>[e(g,{type:"primary",size:"small",onClick:se=>X(s.row)},{default:a(()=>t[19]||(t[19]=[n(" 查看详情 ")])),_:2,__:[19]},1032,["onClick"]),e(g,{type:"warning",size:"small",onClick:se=>Z(s.row)},{default:a(()=>t[20]||(t[20]=[n(" 设置折扣 ")])),_:2,__:[20]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,E.value]]),x.value>0?(z(),F("div",lt,[e(ee,{"current-page":v.value,"onUpdate:currentPage":t[3]||(t[3]=s=>v.value=s),"page-size":P.value,"onUpdate:pageSize":t[4]||(t[4]=s=>P.value=s),"page-sizes":[10,20,50,100],total:x.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Q,onCurrentChange:W},null,8,["current-page","page-size","total"])])):$("",!0)])]),_:1})])]),_:1}),e(B,{modelValue:R.value,"onUpdate:modelValue":t[6]||(t[6]=s=>R.value=s),title:"用户详情",width:"600px"},{footer:a(()=>[e(g,{onClick:t[5]||(t[5]=s=>R.value=!1)},{default:a(()=>t[21]||(t[21]=[n("关闭")])),_:1,__:[21]})]),default:a(()=>[u.value?(z(),F("div",st,[e(te,{column:2,border:""},{default:a(()=>[e(m,{label:"用户ID"},{default:a(()=>[n(r(u.value.id),1)]),_:1}),e(m,{label:"手机号"},{default:a(()=>[n(r(u.value.phone),1)]),_:1}),e(m,{label:"推荐人手机号"},{default:a(()=>[n(r(u.value.referrer_phone),1)]),_:1}),e(m,{label:"注册时间"},{default:a(()=>[n(r(I(u.value.reg_time)),1)]),_:1}),e(m,{label:"累计充值"},{default:a(()=>[n("¥"+r(u.value.total_payment||"0.00"),1)]),_:1}),e(m,{label:"账户余额"},{default:a(()=>[n("¥"+r(u.value.balance||"0.00"),1)]),_:1}),e(m,{label:"折扣"},{default:a(()=>[e(T,{type:"success",size:"small"},{default:a(()=>[n(r(u.value.discount),1)]),_:1})]),_:1}),e(m,{label:"节点数"},{default:a(()=>[n(r(u.value.node_count),1)]),_:1}),e(m,{label:"注册IP",span:2},{default:a(()=>[n(r(u.value.reg_ip),1)]),_:1})]),_:1})])):$("",!0)]),_:1},8,["modelValue"]),e(B,{modelValue:U.value,"onUpdate:modelValue":t[10]||(t[10]=s=>U.value=s),title:"设置用户折扣",width:"400px"},{footer:a(()=>[e(g,{onClick:t[9]||(t[9]=s=>U.value=!1)},{default:a(()=>t[23]||(t[23]=[n("取消")])),_:1,__:[23]}),e(g,{type:"primary",onClick:J,loading:M.value},{default:a(()=>t[24]||(t[24]=[n(" 确定 ")])),_:1,__:[24]},8,["loading"])]),default:a(()=>[e(N,{model:_,rules:H,ref_key:"discountFormRef",ref:S,"label-width":"80px"},{default:a(()=>[e(i,{label:"用户"},{default:a(()=>[e(V,{modelValue:_.phone,"onUpdate:modelValue":t[7]||(t[7]=s=>_.phone=s),disabled:""},null,8,["modelValue"])]),_:1}),e(i,{label:"折扣值",prop:"discount"},{default:a(()=>[e(ae,{modelValue:_.discount,"onUpdate:modelValue":t[8]||(t[8]=s=>_.discount=s),min:.1,max:1,step:.01,precision:2,placeholder:"请输入折扣值",style:{width:"100%"}},null,8,["modelValue"]),t[22]||(t[22]=o("div",{class:"form-tip"},"折扣值范围：0.1 - 1.0",-1))]),_:1,__:[22]})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Vt=oe(ot,[["__scopeId","data-v-dc9fbc31"]]);export{Vt as default};
