import{_ as oe}from"./_plugin-vue_export-helper-e4601500.js";/* empty css                   *//* empty css                     *//* empty css               *//* empty css                 *//* empty css                *//* empty css                   *//* empty css               *//* empty css                  */import{u as re,$ as O,r as i,a0 as Q,o as ne,b as de,ab as Y,c as h,d as x,i as t,w as l,aY as ie,E as C,an as ue,as as ve,g as a,l as u,B as v,k as Z,f as G,F as me,h as ce,m as pe,aZ as _e,X as fe,p as ge,t as be,a_ as he,q as Ce,ap as ye,ao as Ae,a3 as Ve,a4 as ke,a2 as Ie}from"./index-53bb2135.js";import{b as we}from"./browser-9d43139f.js";const xe={class:"profile"},Ue={class:"profile-header"},Ee={class:"avatar-section"},Fe={class:"avatar-overlay"},De={class:"user-basic"},Ne={class:"user-role"},qe={class:"join-time"},ze={class:"profile-stats"},Re={class:"stat-item"},$e={class:"stat-number"},Pe={class:"stat-item"},Te={class:"stat-number"},Be={class:"profile-info"},Se={class:"info-item"},Le={class:"info-value"},Me={class:"info-item"},je={class:"info-value"},Xe={class:"info-item"},Oe={class:"auth-status"},Qe={class:"avatar-grid"},Ye=["onClick"],Ze={class:"dialog-footer"},Ge={class:"auth-content"},He={class:"auth-header"},Je={key:0,class:"qr-code-section"},Ke={class:"qr-code-container"},We={class:"qr-code"},ea=["src"],aa={class:"qr-actions"},ta={key:1,class:"face-auth-section"},la={class:"dialog-footer"},sa={__name:"Profile",setup(oa){const U=re(),o=O(()=>U.userInfo),H=O(()=>{if(o.value.avatar)return o.value.avatar;if(c.value)return c.value;const r=o.value.id||o.value.phone||"1";return`/avatars/avatar${parseInt(r.toString())%6+1}.svg`}),y=i(!1),c=i(""),R=["/avatars/avatar1.svg","/avatars/avatar2.svg","/avatars/avatar3.svg","/avatars/avatar4.svg","/avatars/avatar5.svg","/avatars/avatar6.svg"],I=i(!1),p=i(!1),E=i(),A=i(!1),F=i(""),$=i(""),V=i(!1),f=i(null),n=Q({idName:"",idCard:""}),J={idName:[{required:!0,message:"请输入真实姓名",trigger:"blur"},{min:2,max:10,message:"姓名长度在 2 到 10 个字符",trigger:"blur"}],idCard:[{required:!0,validator:(r,e,m)=>{e?/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(e)?m():m(new Error("请输入正确的身份证号码")):m(new Error("请输入身份证号码"))},trigger:"blur"}]},d=Q({username:"",phone:"",real_name:"",ipAddress:""}),K=r=>{c.value=r},W=()=>{c.value&&(U.updateUserInfo({avatar:c.value}),C.success("头像更新成功"),y.value=!1)},ee=()=>{S()},P=()=>{A.value=!1,F.value="",$.value="",n.idName="",n.idCard="",D()},T=()=>{I.value=!1,P()},B=async(r=!1)=>{try{const e=await ie();if(e.Code===1e3){const m=V.value;V.value=e.DetectAuth||!1,U.updateUserInfo({authentication:e.DetectAuth}),r&&!m&&e.DetectAuth&&(C.success("实名认证完成！"),T(),D())}else console.error("获取认证状态失败:",e.Msg)}catch(e){console.error("获取认证状态失败:",e)}},ae=()=>{f.value&&clearInterval(f.value),f.value=setInterval(()=>{B(!0)},3e3)},D=()=>{f.value&&(clearInterval(f.value),f.value=null)},S=async()=>{if(E.value)try{await E.value.validate(),p.value=!0;const r=await _e({IdName:n.idName,IdCard:n.idCard});if(r.Code===1e3&&r.Url){$.value=r.BizToken;try{const e=await we.toDataURL(r.Url,{width:200,margin:1,color:{dark:"#000000",light:"#FFFFFF"}});F.value=e,A.value=!0,C.success("请使用微信扫描二维码完成人脸认证"),ae()}catch(e){console.error("二维码生成失败:",e),C.error("二维码生成失败，请重试")}}else C.error(r.Msg||"认证失败，请重试")}catch(r){console.error("实名认证失败:",r),C.error("认证失败，请检查网络连接")}finally{p.value=!1}},te=()=>{Object.assign(d,{username:o.value.username||"",real_name:o.value.realName||"",phone:o.value.phone||"",ipAddress:o.value.ipAddress||""})};return ne(()=>{te(),o.value.avatar||(c.value=R[0]),B()}),de(()=>{D()}),(r,e)=>{const m=fe,N=Y("Camera"),q=ge,L=be,le=he,_=Ce,M=ye,k=Ae,g=Ve,b=ke,z=ue,j=Ie,X=ve,se=Y("UserFilled");return h(),x("div",xe,[t(z,{gutter:20},{default:l(()=>[t(k,{xs:24,lg:8},{default:l(()=>[t(M,{class:"profile-card"},{default:l(()=>[a("div",Ue,[a("div",Ee,[a("div",{class:"avatar-container",onClick:e[0]||(e[0]=s=>y.value=!0)},[t(m,{size:100,src:H.value,class:"avatar"},{default:l(()=>{var s,w;return[u(v((w=(s=o.value.username)==null?void 0:s.charAt(0))==null?void 0:w.toUpperCase()),1)]}),_:1},8,["src"]),a("div",Fe,[t(q,null,{default:l(()=>[t(N)]),_:1}),e[11]||(e[11]=a("span",null,"选择头像",-1))])])]),a("div",De,[a("h3",null,v(o.value.username),1),a("p",Ne,[t(L,{type:o.value.role==="admin"?"danger":"primary"},{default:l(()=>[u(v(o.value.role==="admin"?"管理员":"普通用户"),1)]),_:1},8,["type"])]),a("p",qe,"加入时间："+v(o.value.createTime||o.value.reg_time||"--"),1)])]),t(le),a("div",ze,[a("div",Re,[a("div",$e,v(o.value.balance||0),1),e[12]||(e[12]=a("div",{class:"stat-label"},"账户余额",-1))]),a("div",Pe,[a("div",Te,v(o.value.loginTime||o.value.login_time||"--"),1),e[13]||(e[13]=a("div",{class:"stat-label"},"最后登录",-1))])]),a("div",Be,[a("div",Se,[e[14]||(e[14]=a("span",{class:"info-label"},"注册时间：",-1)),a("span",Le,v(o.value.createTime||o.value.reg_time||"--"),1)]),a("div",Me,[e[15]||(e[15]=a("span",{class:"info-label"},"登录IP：",-1)),a("span",je,v(o.value.ipAddress||"--"),1)]),a("div",Xe,[e[17]||(e[17]=a("span",{class:"info-label"},"实名认证：",-1)),a("div",Oe,[t(L,{type:V.value?"success":"warning",size:"small"},{default:l(()=>[u(v(V.value?"已认证":"未认证"),1)]),_:1},8,["type"]),V.value?G("",!0):(h(),Z(_,{key:0,type:"primary",size:"small",onClick:e[1]||(e[1]=s=>I.value=!0),style:{"margin-left":"8px"}},{default:l(()=>e[16]||(e[16]=[u(" 立即认证 ")])),_:1,__:[16]}))])])])]),_:1})]),_:1}),t(k,{xs:24,lg:16},{default:l(()=>[t(M,{class:"form-card"},{header:l(()=>e[18]||(e[18]=[a("div",{class:"card-header"},[a("span",null,"个人信息")],-1)])),default:l(()=>[t(j,{model:d,"label-width":"100px",disabled:!0,class:"profile-form"},{default:l(()=>[t(z,{gutter:20},{default:l(()=>[t(k,{xs:24,md:12},{default:l(()=>[t(b,{label:"用户名",prop:"username"},{default:l(()=>[t(g,{modelValue:d.username,"onUpdate:modelValue":e[2]||(e[2]=s=>d.username=s),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1})]),_:1}),t(k,{xs:24,md:12},{default:l(()=>[t(b,{label:"真实姓名",prop:"real_name"},{default:l(()=>[t(g,{modelValue:d.real_name,"onUpdate:modelValue":e[3]||(e[3]=s=>d.real_name=s),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(z,{gutter:20},{default:l(()=>[t(k,{xs:24,md:12},{default:l(()=>[t(b,{label:"手机号",prop:"phone"},{default:l(()=>[t(g,{modelValue:d.phone,"onUpdate:modelValue":e[4]||(e[4]=s=>d.phone=s),placeholder:"请输入手机号",disabled:!0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(b,{label:"当前IP",prop:"ipAddress"},{default:l(()=>[t(g,{modelValue:d.ipAddress,"onUpdate:modelValue":e[5]||(e[5]=s=>d.ipAddress=s),placeholder:"当前IP地址",disabled:!0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1}),t(X,{modelValue:y.value,"onUpdate:modelValue":e[7]||(e[7]=s=>y.value=s),title:"选择头像",width:"500px",center:""},{footer:l(()=>[a("span",Ze,[t(_,{onClick:e[6]||(e[6]=s=>y.value=!1)},{default:l(()=>e[19]||(e[19]=[u("取消")])),_:1,__:[19]}),t(_,{type:"primary",onClick:W},{default:l(()=>e[20]||(e[20]=[u("确认")])),_:1,__:[20]})])]),default:l(()=>[a("div",Qe,[(h(),x(me,null,ce(R,(s,w)=>a("div",{key:w,class:pe(["avatar-option",{active:c.value===s}]),onClick:na=>K(s)},[t(m,{size:80,src:s},null,8,["src"])],10,Ye)),64))])]),_:1},8,["modelValue"]),t(X,{modelValue:I.value,"onUpdate:modelValue":e[10]||(e[10]=s=>I.value=s),title:"实名认证",width:"500px",center:""},{footer:l(()=>[a("span",la,[t(_,{onClick:T,disabled:p.value},{default:l(()=>[u(v(A.value?"关闭":"取消"),1)]),_:1},8,["disabled"]),A.value?G("",!0):(h(),Z(_,{key:0,type:"primary",onClick:S,loading:p.value,disabled:!n.idName||!n.idCard},{default:l(()=>e[28]||(e[28]=[u(" 提交认证 ")])),_:1,__:[28]},8,["loading","disabled"]))])]),default:l(()=>[a("div",Ge,[a("div",He,[t(q,{class:"auth-icon"},{default:l(()=>[t(se)]),_:1}),e[21]||(e[21]=a("h3",null,"身份验证",-1)),e[22]||(e[22]=a("p",null,"为了保障您的账户安全，请完成实名认证",-1))]),t(j,{ref_key:"authFormRef",ref:E,model:n,rules:J,"label-width":"80px",class:"auth-form"},{default:l(()=>[t(b,{label:"真实姓名",prop:"idName"},{default:l(()=>[t(g,{modelValue:n.idName,"onUpdate:modelValue":e[8]||(e[8]=s=>n.idName=s),placeholder:"请输入真实姓名",disabled:p.value},null,8,["modelValue","disabled"])]),_:1}),t(b,{label:"身份证号",prop:"idCard"},{default:l(()=>[t(g,{modelValue:n.idCard,"onUpdate:modelValue":e[9]||(e[9]=s=>n.idCard=s),placeholder:"请输入身份证号码",disabled:p.value},null,8,["modelValue","disabled"])]),_:1}),A.value?(h(),x("div",Je,[a("div",Ke,[e[24]||(e[24]=a("h4",null,"微信扫码认证",-1)),a("div",We,[a("img",{src:F.value,alt:"认证二维码"},null,8,ea)]),e[25]||(e[25]=a("p",{class:"qr-tip"},"请使用微信扫描上方二维码完成人脸认证",-1)),a("div",aa,[t(_,{onClick:P,size:"small"},{default:l(()=>e[23]||(e[23]=[u("重新认证")])),_:1,__:[23]})])])])):(h(),x("div",ta,[t(_,{type:"primary",size:"large",loading:p.value,onClick:ee,class:"face-auth-btn"},{default:l(()=>[t(q,null,{default:l(()=>[t(N)]),_:1}),e[26]||(e[26]=u(" 开始人脸认证 "))]),_:1,__:[26]},8,["loading"]),e[27]||(e[27]=a("p",{class:"face-auth-tip"},"请确保光线充足，正面面向摄像头",-1))]))]),_:1},8,["model"])])]),_:1},8,["modelValue"])])}}},ha=oe(sa,[["__scopeId","data-v-f6bb6a9f"]]);export{ha as default};
