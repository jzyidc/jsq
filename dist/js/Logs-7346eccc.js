import{_ as ue}from"./_plugin-vue_export-helper-e4601500.js";/* empty css                  *//* empty css                   *//* empty css                             *//* empty css               *//* empty css                     *//* empty css                 */import"./el-tooltip-4ed993c7.js";/* empty css               *//* empty css                *//* empty css                     *//* empty css                       */import{r as E,$ as Y,o as _e,ab as y,c as f,d as k,i as e,w as t,b0 as pe,E as x,aH as ge,az as me,aA as fe,l as u,g as o,D as i,aR as ve,F as ye,h as he,m as be,k as R,L as we,f as U,aT as Ce,aU as Ee,a3 as ke,aV as Le,a2 as ze,p as Se,q as Me,a1 as xe,aI as Ue,b1 as Ve,t as Pe,aY as Ie,aZ as Re,a_ as Fe,a$ as De,b2 as Ye}from"./index-8dfd10b0.js";const Te={class:"logs"},Ae={class:"stat-content"},Be={class:"stat-icon login"},Oe={class:"stat-info"},Ne={class:"stat-number"},je={class:"stat-content"},He={class:"stat-icon security"},$e={class:"stat-info"},qe={class:"stat-number"},Je={class:"stat-content"},Ze={class:"stat-icon profile"},Ge={class:"stat-info"},Ke={class:"stat-number"},Qe={class:"stat-content"},We={class:"stat-icon finance"},Xe={class:"stat-info"},et={class:"stat-number"},tt={class:"card-header"},st={class:"header-actions"},at={class:"logs-list"},ot=["onClick"],lt={class:"log-icon"},nt={class:"log-content"},it={class:"log-header"},ct={class:"log-title"},dt={class:"log-time"},rt={class:"log-description"},ut={class:"log-meta"},_t={class:"log-ip"},pt={class:"log-status"},gt={key:0,class:"pagination-wrapper"},mt={key:0,class:"log-detail"},ft={class:"log-details"},vt={__name:"Logs",setup(yt){const b=E(!1),V=E(!1),P=E(!1),r=E(null),_=Y({type:"",dateRange:[],ip:""}),c=Y({currentPage:1,pageSize:20,total:0}),L=E({totalLogins:156,securityActions:23,profileUpdates:8,financeOperations:45}),m=E([]),T=a=>({login:"UserFilled",logout:"SwitchButton",password_change:"Lock",profile_update:"Edit",security_setting:"Lock",finance_operation:"Money"})[a]||"InfoFilled",A=a=>({login:"icon-login",logout:"icon-logout",password_change:"icon-password",profile_update:"icon-profile",security_setting:"icon-security",finance_operation:"icon-finance"})[a]||"icon-default",F=a=>({login:"success",logout:"info",password_change:"warning",profile_update:"primary",security_setting:"danger",finance_operation:"warning"})[a]||"info",I=a=>({login:"登录",logout:"登出",password_change:"密码修改",profile_update:"资料更新",security_setting:"安全设置",finance_operation:"财务操作"})[a]||"未知",w=async()=>{b.value=!0;try{const a={page:c.currentPage,pageSize:c.pageSize},s=await pe(a);s.code===1e3?(m.value=s.list.map(n=>({id:n.id,type:B(n.log),title:n.log,description:n.log,time:n.time,ip:n.ip,location:"未知地区",device:"Unknown",browser:"Unknown",os:"Unknown",status:"success",details:JSON.stringify({originalLog:n.log,timestamp:n.time,ipAddress:n.ip},null,2)})),c.total=s.row_total,c.currentPage=s.page_now,O()):x.error(s.msg||"获取日志失败")}catch(a){console.error("获取日志失败:",a),x.error("获取日志失败，请重试")}finally{b.value=!1}},B=a=>a.includes("登录")?"login":a.includes("注册")?"profile_update":a.includes("密码")?"password_change":a.includes("安全")?"security_setting":a.includes("财务")||a.includes("充值")||a.includes("提现")||a.includes("转账")?"finance_operation":a.includes("登出")||a.includes("退出")?"logout":"login",O=()=>{const a=m.value.filter(d=>d.type==="login").length,s=m.value.filter(d=>d.type==="security_setting").length,n=m.value.filter(d=>d.type==="profile_update").length,p=m.value.filter(d=>d.type==="finance_operation").length;L.value={totalLogins:a,securityActions:s,profileUpdates:n,financeOperations:p}},N=()=>{c.currentPage=1,w()},j=()=>{_.type="",_.dateRange=[],_.ip="",c.currentPage=1,w()},H=()=>{w()},$=async()=>{V.value=!0;try{await new Promise(v=>setTimeout(v,2e3));const s=[["时间","类型","操作描述","IP地址"].join(","),...m.value.map(v=>[v.time,I(v.type),v.description,v.ip].join(","))].join(`
`),n=new Blob([s],{type:"text/csv;charset=utf-8;"}),p=document.createElement("a"),d=URL.createObjectURL(n);p.setAttribute("href",d),p.setAttribute("download",`操作日志_${new Date().toISOString().slice(0,10)}.csv`),p.style.visibility="hidden",document.body.appendChild(p),p.click(),document.body.removeChild(p),x.success("日志导出成功")}catch{x.error("导出失败，请重试")}finally{V.value=!1}},q=a=>{r.value=a,P.value=!0},J=a=>{c.pageSize=a,c.currentPage=1,w()},Z=a=>{c.currentPage=a,w()};return _e(()=>{w()}),(a,s)=>{const n=Ce,p=Ee,d=ke,v=Le,G=ze,K=y("Search"),g=Se,z=Me,D=y("Refresh"),Q=y("Download"),W=xe,C=ge,X=y("UserFilled"),S=Ue,ee=y("Lock"),te=y("Edit"),se=y("Money"),ae=me,oe=Ve,M=Pe,le=y("Monitor"),ne=Ye,ie=Ie,h=Re,ce=Fe,de=fe,re=De;return f(),k("div",Te,[e(C,{class:"filter-card"},{default:t(()=>[e(W,{model:_,inline:"",class:"filter-form"},{default:t(()=>[e(d,{label:"操作类型"},{default:t(()=>[e(p,{modelValue:_.type,"onUpdate:modelValue":s[0]||(s[0]=l=>_.type=l),placeholder:"全部类型",clearable:"",style:{width:"150px"}},{default:t(()=>[e(n,{label:"全部",value:""}),e(n,{label:"登录",value:"login"}),e(n,{label:"登出",value:"logout"}),e(n,{label:"密码修改",value:"password_change"}),e(n,{label:"资料更新",value:"profile_update"}),e(n,{label:"安全设置",value:"security_setting"}),e(n,{label:"财务操作",value:"finance_operation"})]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"时间范围"},{default:t(()=>[e(v,{modelValue:_.dateRange,"onUpdate:modelValue":s[1]||(s[1]=l=>_.dateRange=l),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"350px"}},null,8,["modelValue"])]),_:1}),e(d,{label:"IP地址"},{default:t(()=>[e(G,{modelValue:_.ip,"onUpdate:modelValue":s[2]||(s[2]=l=>_.ip=l),placeholder:"请输入IP地址",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),e(d,null,{default:t(()=>[e(z,{type:"primary",onClick:N,loading:b.value},{default:t(()=>[e(g,null,{default:t(()=>[e(K)]),_:1}),s[6]||(s[6]=u(" 搜索 "))]),_:1,__:[6]},8,["loading"]),e(z,{onClick:j},{default:t(()=>[e(g,null,{default:t(()=>[e(D)]),_:1}),s[7]||(s[7]=u(" 重置 "))]),_:1,__:[7]}),e(z,{type:"success",onClick:$,loading:V.value},{default:t(()=>[e(g,null,{default:t(()=>[e(Q)]),_:1}),s[8]||(s[8]=u(" 导出 "))]),_:1,__:[8]},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),e(ae,{gutter:20,class:"stats-row"},{default:t(()=>[e(S,{xs:12,sm:6},{default:t(()=>[e(C,{class:"stat-card"},{default:t(()=>[o("div",Ae,[o("div",Be,[e(g,null,{default:t(()=>[e(X)]),_:1})]),o("div",Oe,[o("div",Ne,i(L.value.totalLogins),1),s[9]||(s[9]=o("div",{class:"stat-label"},"总登录次数",-1))])])]),_:1})]),_:1}),e(S,{xs:12,sm:6},{default:t(()=>[e(C,{class:"stat-card"},{default:t(()=>[o("div",je,[o("div",He,[e(g,null,{default:t(()=>[e(ee)]),_:1})]),o("div",$e,[o("div",qe,i(L.value.securityActions),1),s[10]||(s[10]=o("div",{class:"stat-label"},"安全操作",-1))])])]),_:1})]),_:1}),e(S,{xs:12,sm:6},{default:t(()=>[e(C,{class:"stat-card"},{default:t(()=>[o("div",Je,[o("div",Ze,[e(g,null,{default:t(()=>[e(te)]),_:1})]),o("div",Ge,[o("div",Ke,i(L.value.profileUpdates),1),s[11]||(s[11]=o("div",{class:"stat-label"},"资料更新",-1))])])]),_:1})]),_:1}),e(S,{xs:12,sm:6},{default:t(()=>[e(C,{class:"stat-card"},{default:t(()=>[o("div",Qe,[o("div",We,[e(g,null,{default:t(()=>[e(se)]),_:1})]),o("div",Xe,[o("div",et,i(L.value.financeOperations),1),s[12]||(s[12]=o("div",{class:"stat-label"},"财务操作",-1))])])]),_:1})]),_:1})]),_:1}),e(C,{class:"logs-card"},{header:t(()=>[o("div",tt,[s[13]||(s[13]=o("span",null,"操作日志",-1)),o("div",st,[e(oe,{content:"刷新"},{default:t(()=>[e(z,{circle:"",onClick:H,loading:b.value},{default:t(()=>[e(g,null,{default:t(()=>[e(D)]),_:1})]),_:1},8,["loading"])]),_:1})])])]),default:t(()=>[ve((f(),k("div",at,[(f(!0),k(ye,null,he(m.value,l=>(f(),k("div",{key:l.id,class:"log-item",onClick:ht=>q(l)},[o("div",lt,[e(g,{class:be(A(l.type))},{default:t(()=>[(f(),R(we(T(l.type))))]),_:2},1032,["class"])]),o("div",nt,[o("div",it,[o("div",ct,i(l.title),1),o("div",dt,i(l.time),1)]),o("div",rt,i(l.description),1),o("div",ut,[e(M,{type:F(l.type),size:"small"},{default:t(()=>[u(i(I(l.type)),1)]),_:2},1032,["type"]),o("span",_t,[e(g,null,{default:t(()=>[e(le)]),_:1}),u(" "+i(l.ip),1)])])]),o("div",pt,[e(M,{type:l.status==="success"?"success":"danger",size:"small"},{default:t(()=>[u(i(l.status==="success"?"成功":"失败"),1)]),_:2},1032,["type"])])],8,ot))),128)),!b.value&&m.value.length===0?(f(),R(ne,{key:0,description:"暂无操作日志","image-size":100})):U("",!0)])),[[re,b.value]]),m.value.length>0?(f(),k("div",gt,[e(ie,{"current-page":c.currentPage,"onUpdate:currentPage":s[3]||(s[3]=l=>c.currentPage=l),"page-size":c.pageSize,"onUpdate:pageSize":s[4]||(s[4]=l=>c.pageSize=l),"page-sizes":[10,20,50,100],total:c.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:J,onCurrentChange:Z},null,8,["current-page","page-size","total"])])):U("",!0)]),_:1}),e(de,{modelValue:P.value,"onUpdate:modelValue":s[5]||(s[5]=l=>P.value=l),title:"操作日志详情",width:"600px","close-on-click-modal":!1},{default:t(()=>[r.value?(f(),k("div",mt,[e(ce,{column:1,border:""},{default:t(()=>[e(h,{label:"操作类型"},{default:t(()=>[e(M,{type:F(r.value.type),size:"small"},{default:t(()=>[u(i(I(r.value.type)),1)]),_:1},8,["type"])]),_:1}),e(h,{label:"操作标题"},{default:t(()=>[u(i(r.value.title),1)]),_:1}),e(h,{label:"操作描述"},{default:t(()=>[u(i(r.value.description),1)]),_:1}),e(h,{label:"操作时间"},{default:t(()=>[u(i(r.value.time),1)]),_:1}),e(h,{label:"IP地址"},{default:t(()=>[u(i(r.value.ip),1)]),_:1}),e(h,{label:"操作状态"},{default:t(()=>[e(M,{type:r.value.status==="success"?"success":"danger",size:"small"},{default:t(()=>[u(i(r.value.status==="success"?"成功":"失败"),1)]),_:1},8,["type"])]),_:1}),r.value.details?(f(),R(h,{key:0,label:"详细信息"},{default:t(()=>[o("pre",ft,i(r.value.details),1)]),_:1})):U("",!0)]),_:1})])):U("",!0)]),_:1},8,["modelValue"])])}}},It=ue(vt,[["__scopeId","data-v-215a6420"]]);export{It as default};
