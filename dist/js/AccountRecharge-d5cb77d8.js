import{_ as $}from"./_plugin-vue_export-helper-e4601500.js";/* empty css                   *//* empty css                 */import{u as H,r as l,o as W,b as z,ab as Q,c as E,d as M,g as t,D as _,j as P,i as c,w as v,m as A,l as i,e as Y,E as s,aL as G,a2 as J,q as K,aA as X,aM as Z,f as ee,ar as ae,p as te}from"./index-cf8bdcfb.js";import{r as se,g as V,a as le}from"./finance-f416d1f2.js";import{b as oe}from"./browser-9d43139f.js";const ne="/alipay.png";const re={class:"recharge-container"},ce={class:"balance-section"},ie={class:"balance-amount"},ue={class:"recharge-records-link"},de={class:"recharge-card"},ve={class:"amount-input-section"},pe={class:"payment-section"},fe={class:"payment-methods"},me={class:"submit-section"},ye={class:"qr-code-container"},be={class:"payment-info"},ge={class:"amount"},_e={class:"order-number"},he={class:"qr-code-wrapper"},we={class:"qr-tip"},xe={key:0,class:"auto-check-tip"},Ce={class:"payment-status"},ke={__name:"AccountRecharge",setup(Ee){const h=H(),w=l(!1),u=l(!1),x=l(!1),n=l(1),o=l("alipay"),r=l(""),b=l(""),p=l(null),f=l(null),g=l(0),m=l(!0),y=l(!1),D=async()=>{if(!n.value||n.value<=0){s.error("请选择充值金额");return}if(n.value>1e4){s.error("单次充值金额不能超过10000元");return}w.value=!0;try{const a=await se(n.value,o.value);a.Code===1e3?(r.value=a.OrderNumber,b.value=a.Parameter,u.value=!0,await G(),await U(a.Parameter),B(),s.success("订单创建成功，请扫码支付")):s.error(a.Message||"创建订单失败")}catch(a){console.error("充值失败:",a),s.error("充值失败，请稍后重试")}finally{w.value=!1}},U=async a=>{try{if(p.value)if(o.value==="wechat")try{const e=await oe.toDataURL(a,{width:200,margin:1,color:{dark:"#000000",light:"#FFFFFF"}});p.value.innerHTML=`
            <img src="${e}" style="width:100%;height:100%;object-fit:contain;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,0.1);" />
          `}catch(e){console.error("生成微信支付二维码失败:",e),s.error("生成微信支付二维码失败")}else/\.(png|jpg|jpeg|gif|bmp|webp)(\?.*)?$/i.test(a)?p.value.innerHTML=`
            <img src="${a}" style="width:100%;height:100%;object-fit:contain;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,0.1);" />
          `:p.value.innerHTML=`
            <iframe 
              src="${a}" 
              frameborder="0" 
              style="width:100%;height:100%;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,0.1);overflow:hidden;scrolling:no;"
            ></iframe>
          `}catch(e){console.error("显示支付链接失败:",e),s.error("显示支付链接失败")}},q=async()=>{if(!r.value){s.error("订单号不存在");return}x.value=!0;try{const a=await V(r.value);if(a.Code===1e3)s.success("支付成功！"),d(),u.value=!1,r.value="",b.value="",await h.getUserInfoAction(),window.dispatchEvent(new CustomEvent("recharge-success"));else if(a.Code===-111)s.warning("订单尚未支付，请完成支付后再次检查");else{const e=a.Msg||a.Message||"查询支付状态失败";s.error(e)}}catch(a){console.error("检查支付状态失败:",a),s.error("检查支付状态失败，请稍后重试")}finally{x.value=!1}},I=()=>{ae.confirm("确定要取消支付吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{d(),u.value=!1,r.value="",b.value=""})},B=()=>{d(),g.value=0,f.value=setInterval(async()=>{if(g.value++,g.value>24){d(),s.info("自动检查已停止，请手动检查支付状态");return}await R()},5e3)},d=()=>{f.value&&(clearInterval(f.value),f.value=null),g.value=0},R=async()=>{if(r.value)try{(await V(r.value)).Code===1e3&&(s.success("支付成功！"),d(),u.value=!1,r.value="",b.value="",await h.getUserInfoAction(),window.dispatchEvent(new CustomEvent("recharge-success")))}catch(a){console.error("自动检查支付状态失败:",a)}},S=async()=>{try{const a=await le();a.Code===1e3&&(m.value=a.alipay||!1,y.value=a.wxpay||!1,o.value==="alipay"&&!m.value?y.value&&(o.value="wechat"):o.value==="wechat"&&!y.value&&m.value&&(o.value="alipay"))}catch(a){console.error("加载支付选项失败:",a)}},T=()=>{if(!m.value){s.warning("支付宝支付未开启");return}o.value="alipay"},L=()=>{if(!y.value){s.warning("微信支付未开启");return}o.value="wechat"};return W(()=>{S()}),z(()=>{d()}),(a,e)=>{const N=Q("router-link"),F=J,C=K,j=te,O=X;return E(),M("div",re,[t("div",ce,[e[3]||(e[3]=t("div",{class:"balance-label"},"账户余额（元）",-1)),t("div",ie,_(P(h).userInfo.balance||3.5),1),t("div",ue,[c(N,{to:"/user/recharge-records"},{default:v(()=>e[2]||(e[2]=[i("充值记录")])),_:1,__:[2]})])]),t("div",de,[e[9]||(e[9]=t("div",{class:"card-title"},"在线充值",-1)),t("div",ve,[e[4]||(e[4]=t("div",{class:"input-label"},"充值金额：",-1)),c(F,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=k=>n.value=k),modelModifiers:{number:!0},placeholder:"1",type:"number",min:1,max:1e4,class:"amount-input"},null,8,["modelValue"])]),t("div",pe,[e[7]||(e[7]=t("div",{class:"payment-label"},"支付方式：",-1)),t("div",fe,[t("div",{class:A(["payment-option",{selected:o.value==="alipay",disabled:!m.value}]),onClick:T},e[5]||(e[5]=[t("img",{src:ne,alt:"支付宝",class:"payment-icon"},null,-1),t("span",{class:"payment-text"},[i("支付宝"),t("br"),i("ALIPAY")],-1)]),2),t("div",{class:A(["payment-option",{selected:o.value==="wechat",disabled:!y.value}]),onClick:L},e[6]||(e[6]=[Y('<svg width="40" height="40" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg" class="payment-icon" data-v-9c5b45be><rect width="32" height="32" rx="8" fill="#2DC100" data-v-9c5b45be></rect><g data-v-9c5b45be><ellipse cx="20.5" cy="14.5" rx="6.5" ry="5.5" fill="#fff" data-v-9c5b45be></ellipse><ellipse cx="13" cy="19" rx="7" ry="6" fill="#fff" data-v-9c5b45be></ellipse><circle cx="11.5" cy="18.5" r="1" fill="#2DC100" data-v-9c5b45be></circle><circle cx="15.5" cy="18.5" r="1" fill="#2DC100" data-v-9c5b45be></circle><circle cx="19" cy="13.5" r="1" fill="#2DC100" data-v-9c5b45be></circle><circle cx="22.5" cy="13.5" r="1" fill="#2DC100" data-v-9c5b45be></circle></g></svg><span class="payment-text" data-v-9c5b45be>微信支付<br data-v-9c5b45be>WeChat Pay</span>',2)]),2)])]),t("div",me,[c(C,{type:"primary",loading:w.value,disabled:!n.value||n.value<=0,onClick:D,class:"recharge-btn"},{default:v(()=>e[8]||(e[8]=[i(" 立即充值 ")])),_:1,__:[8]},8,["loading","disabled"])])]),c(O,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=k=>u.value=k),title:"支付宝支付",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1},{default:v(()=>[t("div",ye,[t("div",be,[t("p",null,[e[10]||(e[10]=i("充值金额：")),t("span",ge,"¥"+_(n.value),1)]),t("p",null,[e[11]||(e[11]=i("订单号：")),t("span",_e,_(r.value),1)])]),t("div",he,[t("div",{ref_key:"qrCodeRef",ref:p,class:"qr-code"},null,512),t("p",we,"请使用"+_(o.value==="wechat"?"微信":"支付宝")+"扫描二维码完成支付",1),f.value?(E(),M("div",xe,[c(j,{class:"rotating"},{default:v(()=>[c(P(Z))]),_:1}),e[12]||(e[12]=t("span",null,"系统正在自动检查支付状态...",-1))])):ee("",!0)]),t("div",Ce,[c(C,{onClick:q,loading:x.value},{default:v(()=>e[13]||(e[13]=[i(" 检查支付状态 ")])),_:1,__:[13]},8,["loading"]),c(C,{onClick:I,type:"info"},{default:v(()=>e[14]||(e[14]=[i(" 取消支付 ")])),_:1,__:[14]})])])]),_:1},8,["modelValue"])])}}},qe=$(ke,[["__scopeId","data-v-9c5b45be"]]);export{qe as default};
