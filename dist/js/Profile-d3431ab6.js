import{_ as pe}from"./_plugin-vue_export-helper-f918498f.js";/* empty css                   *//* empty css                     *//* empty css               *//* empty css                 *//* empty css                *//* empty css                   *//* empty css               *//* empty css                  */import{u as ce,a9 as W,r as d,$ as T,o as fe,b as _e,ab as Y,c as g,d as A,i as a,w as s,aK as ge,E as p,az as be,aA as qe,g as l,l as i,D as v,k as M,f as Z,F as Ce,h as ye,m as we,aL as xe,aM as he,X as Ve,p as Ae,t as ke,aN as Ie,q as Ue,aI as Ee,aJ as Fe,a2 as De,a3 as Ne,a1 as ze}from"./index-77fd0c89.js";import{b as Re}from"./browser-9d43139f.js";const $e={class:"profile"},Pe={class:"profile-header"},Qe={class:"avatar-section"},Te={class:"avatar-overlay"},Me={class:"user-basic"},Be={class:"user-role"},Le={class:"join-time"},Se={class:"profile-stats"},je={class:"stat-item"},Oe={class:"stat-number"},Xe={class:"stat-item"},Je={class:"stat-number"},Ke={class:"profile-info"},Ge={class:"info-item"},He={class:"info-value"},We={class:"info-item"},Ye={class:"info-value"},Ze={class:"info-item"},ea={class:"info-value"},aa={class:"info-item"},la={class:"info-value"},sa={class:"info-item"},ta={class:"auth-status"},oa={class:"card-header"},ra={class:"header-actions"},na={key:1,class:"edit-actions"},da={class:"avatar-grid"},ia=["onClick"],ua={class:"dialog-footer"},va={class:"auth-content"},ma={class:"auth-header"},pa={key:0,class:"qr-code-section"},ca={class:"qr-code-container"},fa={class:"qr-code"},_a=["src"],ga={class:"qr-actions"},ba={key:1,class:"face-auth-section"},qa={class:"dialog-footer"},Ca={__name:"Profile",setup(ya){const k=ce(),o=W(()=>k.userInfo),ee=W(()=>{if(o.value.avatar)return o.value.avatar;if(b.value)return b.value;const n=o.value.id||o.value.phone||"1";return`/avatars/avatar${parseInt(n.toString())%6+1}.svg`}),x=d(!1),b=d(""),B=["/avatars/avatar1.svg","/avatars/avatar2.svg","/avatars/avatar3.svg","/avatars/avatar4.svg","/avatars/avatar5.svg","/avatars/avatar6.svg"],I=d(!1),q=d(!1),F=d(),h=d(!1),D=d(""),L=d(""),V=d(!1),y=d(null),u=T({idName:"",idCard:""}),ae={idName:[{required:!0,message:"请输入真实姓名",trigger:"blur"},{min:2,max:10,message:"姓名长度在 2 到 10 个字符",trigger:"blur"}],idCard:[{required:!0,validator:(n,e,c)=>{e?/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(e)?c():c(new Error("请输入正确的身份证号码")):c(new Error("请输入身份证号码"))},trigger:"blur"}]},w=d(!1),N=d(!1),z=d(),r=T({username:"",phone:"",real_name:"",ipAddress:"",qq:"",wx:""}),R=T({}),le={qq:[{pattern:/^[1-9][0-9]{4,10}$/,message:"请输入正确的QQ号",trigger:"blur"}],wx:[{min:1,max:20,message:"微信号长度在 1 到 20 个字符",trigger:"blur"}]},se=n=>{b.value=n},te=()=>{b.value&&(k.updateUserInfo({avatar:b.value}),p.success("头像更新成功"),x.value=!1)},oe=()=>{X()},S=()=>{h.value=!1,D.value="",L.value="",u.idName="",u.idCard="",$()},j=()=>{I.value=!1,S()},O=async(n=!1)=>{try{const e=await ge();if(e.Code===1e3){const c=V.value;V.value=e.DetectAuth||!1,k.updateUserInfo({authentication:e.DetectAuth}),n&&!c&&e.DetectAuth&&(p.success("实名认证完成！"),j(),$())}else console.error("获取认证状态失败:",e.Msg)}catch(e){console.error("获取认证状态失败:",e)}},re=()=>{y.value&&clearInterval(y.value),y.value=setInterval(()=>{O(!0)},3e3)},$=()=>{y.value&&(clearInterval(y.value),y.value=null)},X=async()=>{if(F.value)try{await F.value.validate(),q.value=!0;const n=await xe({IdName:u.idName,IdCard:u.idCard});if(n.Code===1e3&&n.Url){L.value=n.BizToken;try{const e=await Re.toDataURL(n.Url,{width:200,margin:1,color:{dark:"#000000",light:"#FFFFFF"}});D.value=e,h.value=!0,p.success("请使用微信扫描二维码完成人脸认证"),re()}catch(e){console.error("二维码生成失败:",e),p.error("二维码生成失败，请重试")}}else p.error(n.Msg||"认证失败，请重试")}catch(n){console.error("实名认证失败:",n),p.error("认证失败，请检查网络连接")}finally{q.value=!1}},ne=()=>{w.value=!0,Object.assign(R,{qq:r.qq,wx:r.wx})},de=()=>{w.value=!1,r.qq=R.qq,r.wx=R.wx},ie=async()=>{if(z.value)try{await z.value.validate(),N.value=!0;const n=await he({qq:r.qq||"",wx:r.wx||""});n.Code===1e3?(p.success(n.Msg||"设置成功"),k.updateUserInfo({qq:r.qq,wx:r.wx}),w.value=!1):p.error(n.Msg||"保存失败")}catch(n){console.error("保存联系信息失败:",n),p.error("保存失败，请检查网络连接")}finally{N.value=!1}},ue=()=>{Object.assign(r,{username:o.value.username||"",real_name:o.value.realName||"",phone:o.value.phone||"",ipAddress:o.value.ipAddress||"",qq:o.value.qq||"",wx:o.value.wx||""})};return fe(()=>{ue(),o.value.avatar||(b.value=B[0]),O()}),_e(()=>{$()}),(n,e)=>{const c=Ve,P=Y("Camera"),Q=Ae,J=ke,ve=Ie,m=Ue,K=Ee,C=Fe,f=De,_=Ne,U=be,G=ze,H=qe,me=Y("UserFilled");return g(),A("div",$e,[a(U,{gutter:20},{default:s(()=>[a(C,{xs:24,lg:8},{default:s(()=>[a(K,{class:"profile-card"},{default:s(()=>[l("div",Pe,[l("div",Qe,[l("div",{class:"avatar-container",onClick:e[0]||(e[0]=t=>x.value=!0)},[a(c,{size:100,src:ee.value,class:"avatar"},{default:s(()=>{var t,E;return[i(v((E=(t=o.value.username)==null?void 0:t.charAt(0))==null?void 0:E.toUpperCase()),1)]}),_:1},8,["src"]),l("div",Te,[a(Q,null,{default:s(()=>[a(P)]),_:1}),e[13]||(e[13]=l("span",null,"选择头像",-1))])])]),l("div",Me,[l("h3",null,v(o.value.username),1),l("p",Be,[a(J,{type:"primary"},{default:s(()=>e[14]||(e[14]=[i(" 普通用户 ")])),_:1,__:[14]})]),l("p",Le,"加入时间："+v(o.value.createTime||o.value.reg_time||"--"),1)])]),a(ve),l("div",Se,[l("div",je,[l("div",Oe,v(o.value.balance||0),1),e[15]||(e[15]=l("div",{class:"stat-label"},"账户余额",-1))]),l("div",Xe,[l("div",Je,v(o.value.loginTime||o.value.login_time||"--"),1),e[16]||(e[16]=l("div",{class:"stat-label"},"最后登录",-1))])]),l("div",Ke,[l("div",Ge,[e[17]||(e[17]=l("span",{class:"info-label"},"注册时间：",-1)),l("span",He,v(o.value.createTime||o.value.reg_time||"--"),1)]),l("div",We,[e[18]||(e[18]=l("span",{class:"info-label"},"登录IP：",-1)),l("span",Ye,v(o.value.ipAddress||"--"),1)]),l("div",Ze,[e[19]||(e[19]=l("span",{class:"info-label"},"QQ：",-1)),l("span",ea,v(o.value.qq||"--"),1)]),l("div",aa,[e[20]||(e[20]=l("span",{class:"info-label"},"微信：",-1)),l("span",la,v(o.value.wx||"--"),1)]),l("div",sa,[e[22]||(e[22]=l("span",{class:"info-label"},"实名认证：",-1)),l("div",ta,[a(J,{type:V.value?"success":"warning",size:"small"},{default:s(()=>[i(v(V.value?"已认证":"未认证"),1)]),_:1},8,["type"]),V.value?Z("",!0):(g(),M(m,{key:0,type:"primary",size:"small",onClick:e[1]||(e[1]=t=>I.value=!0),style:{"margin-left":"8px"}},{default:s(()=>e[21]||(e[21]=[i(" 立即认证 ")])),_:1,__:[21]}))])])])]),_:1})]),_:1}),a(C,{xs:24,lg:16},{default:s(()=>[a(K,{class:"form-card"},{header:s(()=>[l("div",oa,[e[26]||(e[26]=l("span",null,"个人信息",-1)),l("div",ra,[w.value?(g(),A("div",na,[a(m,{size:"small",onClick:de},{default:s(()=>e[24]||(e[24]=[i("取消")])),_:1,__:[24]}),a(m,{type:"primary",size:"small",onClick:ie,loading:N.value},{default:s(()=>e[25]||(e[25]=[i("保存")])),_:1,__:[25]},8,["loading"])])):(g(),M(m,{key:0,type:"primary",size:"small",onClick:ne},{default:s(()=>e[23]||(e[23]=[i(" 编辑资料 ")])),_:1,__:[23]}))])])]),default:s(()=>[a(G,{ref_key:"profileFormRef",ref:z,model:r,rules:le,"label-width":"100px",class:"profile-form"},{default:s(()=>[a(U,{gutter:20},{default:s(()=>[a(C,{xs:24,md:12},{default:s(()=>[a(_,{label:"用户名",prop:"username"},{default:s(()=>[a(f,{modelValue:r.username,"onUpdate:modelValue":e[2]||(e[2]=t=>r.username=t),placeholder:"请输入用户名",disabled:!0},null,8,["modelValue"])]),_:1})]),_:1}),a(C,{xs:24,md:12},{default:s(()=>[a(_,{label:"真实姓名",prop:"real_name"},{default:s(()=>[a(f,{modelValue:r.real_name,"onUpdate:modelValue":e[3]||(e[3]=t=>r.real_name=t),placeholder:"请输入真实姓名",disabled:!0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(U,{gutter:20},{default:s(()=>[a(C,{xs:24,md:12},{default:s(()=>[a(_,{label:"手机号",prop:"phone"},{default:s(()=>[a(f,{modelValue:r.phone,"onUpdate:modelValue":e[4]||(e[4]=t=>r.phone=t),placeholder:"请输入手机号",disabled:!0},null,8,["modelValue"])]),_:1})]),_:1}),a(C,{xs:24,md:12},{default:s(()=>[a(_,{label:"QQ",prop:"qq"},{default:s(()=>[a(f,{modelValue:r.qq,"onUpdate:modelValue":e[5]||(e[5]=t=>r.qq=t),placeholder:"请输入QQ号",disabled:!w.value},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),a(U,{gutter:20},{default:s(()=>[a(C,{xs:24,md:12},{default:s(()=>[a(_,{label:"微信",prop:"wx"},{default:s(()=>[a(f,{modelValue:r.wx,"onUpdate:modelValue":e[6]||(e[6]=t=>r.wx=t),placeholder:"请输入微信号",disabled:!w.value},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),a(_,{label:"当前IP",prop:"ipAddress"},{default:s(()=>[a(f,{modelValue:r.ipAddress,"onUpdate:modelValue":e[7]||(e[7]=t=>r.ipAddress=t),placeholder:"当前IP地址",disabled:!0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1}),a(H,{modelValue:x.value,"onUpdate:modelValue":e[9]||(e[9]=t=>x.value=t),title:"选择头像",width:"500px",center:""},{footer:s(()=>[l("span",ua,[a(m,{onClick:e[8]||(e[8]=t=>x.value=!1)},{default:s(()=>e[27]||(e[27]=[i("取消")])),_:1,__:[27]}),a(m,{type:"primary",onClick:te},{default:s(()=>e[28]||(e[28]=[i("确认")])),_:1,__:[28]})])]),default:s(()=>[l("div",da,[(g(),A(Ce,null,ye(B,(t,E)=>l("div",{key:E,class:we(["avatar-option",{active:b.value===t}]),onClick:xa=>se(t)},[a(c,{size:80,src:t},null,8,["src"])],10,ia)),64))])]),_:1},8,["modelValue"]),a(H,{modelValue:I.value,"onUpdate:modelValue":e[12]||(e[12]=t=>I.value=t),title:"实名认证",width:"500px",center:""},{footer:s(()=>[l("span",qa,[a(m,{onClick:j,disabled:q.value},{default:s(()=>[i(v(h.value?"关闭":"取消"),1)]),_:1},8,["disabled"]),h.value?Z("",!0):(g(),M(m,{key:0,type:"primary",onClick:X,loading:q.value,disabled:!u.idName||!u.idCard},{default:s(()=>e[36]||(e[36]=[i(" 提交认证 ")])),_:1,__:[36]},8,["loading","disabled"]))])]),default:s(()=>[l("div",va,[l("div",ma,[a(Q,{class:"auth-icon"},{default:s(()=>[a(me)]),_:1}),e[29]||(e[29]=l("h3",null,"身份验证",-1)),e[30]||(e[30]=l("p",null,"为了保障您的账户安全，请完成实名认证",-1))]),a(G,{ref_key:"authFormRef",ref:F,model:u,rules:ae,"label-width":"80px",class:"auth-form"},{default:s(()=>[a(_,{label:"真实姓名",prop:"idName"},{default:s(()=>[a(f,{modelValue:u.idName,"onUpdate:modelValue":e[10]||(e[10]=t=>u.idName=t),placeholder:"请输入真实姓名",disabled:q.value},null,8,["modelValue","disabled"])]),_:1}),a(_,{label:"身份证号",prop:"idCard"},{default:s(()=>[a(f,{modelValue:u.idCard,"onUpdate:modelValue":e[11]||(e[11]=t=>u.idCard=t),placeholder:"请输入身份证号码",disabled:q.value},null,8,["modelValue","disabled"])]),_:1}),h.value?(g(),A("div",pa,[l("div",ca,[e[32]||(e[32]=l("h4",null,"微信扫码认证",-1)),l("div",fa,[l("img",{src:D.value,alt:"认证二维码"},null,8,_a)]),e[33]||(e[33]=l("p",{class:"qr-tip"},"请使用微信扫描上方二维码完成人脸认证",-1)),l("div",ga,[a(m,{onClick:S,size:"small"},{default:s(()=>e[31]||(e[31]=[i("重新认证")])),_:1,__:[31]})])])])):(g(),A("div",ba,[a(m,{type:"primary",size:"large",loading:q.value,onClick:oe,class:"face-auth-btn"},{default:s(()=>[a(Q,null,{default:s(()=>[a(P)]),_:1}),e[34]||(e[34]=i(" 开始人脸认证 "))]),_:1,__:[34]},8,["loading"]),e[35]||(e[35]=l("p",{class:"face-auth-tip"},"请确保光线充足，正面面向摄像头",-1))]))]),_:1},8,["model"])])]),_:1},8,["modelValue"])])}}},Ra=pe(Ca,[["__scopeId","data-v-8738a77d"]]);export{Ra as default};
